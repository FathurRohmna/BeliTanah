<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>BeliTanah | Halaman utama</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>
    <div class="relative w-full">
        <!-- Navbar and other content omitted for brevity -->
        <div class="w-full bg-gray-900 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
                <h5 class="font-bold text-lg">Kenali kita lebih lanjut <a href="./tentang.html"
                        class="underline">disini</a></h5>
            </div>
        </div>
        <div class="relative w-full">
            <div class="absolute top-0 right-0 left-0 bg-white/70">
                <div class="max-w-7xl mx-auto">
                    <div class="relative z-10 lg:pb-8 pb-0 bg-transparent">
                        <div class="relative pt-6 px-4 sm:px-6 lg:px-8">
                            <nav class="relative flex items-center justify-between sm:h-10">
                                <div class="flex items-center flex-grow flex-shrink-0 lg:flex-grow-0">
                                    <div class="flex items-center justify-between w-full md:w-auto">
                                        <a href="./index.html" class="ml-2">
                                            <span class="sr-only">BeliTanah</span>
                                            <img class="h-6 w-auto" src="/assets/images/beli-tanah.png" />
                                        </a>
                                    </div>
                                </div>
                                <div class="hidden md:block md:ml-10 md:pr-4 md:space-x-8">
                                    <a href="./list-tanah.html"
                                        class="font-semibold text-lg text-gray-700 hover:text-gray-500">List tanah</a>
                                    <a href="./list-agen.html"
                                        class="font-semibold text-lg text-gray-700 hover:text-gray-500">List agen</a>
                                    <a href="./simulasi-harga.html"
                                        class="font-semibold text-lg text-gray-700 hover:text-gray-500">Simulasi
                                        harga</a>
                                    <a href="./kontak.html"
                                        class="font-semibold text-lg  text-gray-700 hover:text-gray-500">Kontak</a>
                                    <a href="./authentikasi.html"
                                        class="font-semibold text-lg  text-gray-700 hover:text-gray-500">Jual tanah</a>
                                </div>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <main class="min-h-[80vh] my-24">
            <div class="max-w-7xl mx-auto space-y-6">
                <h3 class="mt-6 text-3xl font-bold">List Tanah</h3>

                <div>
                    <form method="GET" action="" id="filterForm" class="flex items-center max-w-[80%] gap-4 whitespace-nowrap">
                        <!-- Search by Location -->
                        <input type="search" name="lokasi" placeholder="Search by location..." aria-label="Search" value="" />
                    
                        <!-- Filter by Size -->
                        <select name="size" class="block w-full px-4 py-3 text-base text-gray-900 border border-gray-300 rounded-lg bg-gray-50">
                            <option value="">Select Size</option>
                            <option value="24x24">24x24 m</option>
                            <option value="30x40">30x40 m</option>
                            <option value="50x60">50x60 m</option>
                        </select>
                    
                        <!-- Filter by Type -->
                        <select name="type" class="block w-full px-4 py-3 text-base text-gray-900 border border-gray-300 rounded-lg bg-gray-50">
                            <option value="">Select Type</option>
                            <option value="Residential">Residential</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Agricultural">Agricultural</option>
                        </select>
                    
                        <!-- Filter by Installments -->
                        <select name="angsur" class="block w-full px-4 py-3 text-base text-gray-900 border border-gray-300 rounded-lg bg-gray-50">
                            <option value="">Installment Option</option>
                            <option value="Yes">Yes, Bisa Angsur</option>
                            <option value="No">No</option>
                        </select>
                    
                        <!-- Filter by Negotiable -->
                        <select name="negotiable" class="block w-full px-4 py-3 text-base text-gray-900 border border-gray-300 rounded-lg bg-gray-50">
                            <option value="">Negotiable</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    
                        <button type="submit">Apply Filter</button>
                    </form>
                </div>

                <div id="tanah-rekomendasi"
                    class="grid w-full grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 lg:gap-6">
                </div>

                <!-- Negotiable Modal -->
                <div id="negosiasi-modal" class="custom-modal">
                    <div class="custom-modal-content" style="max-width: 360px; margin: 0 auto;">
                        <h3 class="fw-bold fs-4">Negotiable Item</h3>
                        <div id="negotiable-item-content">
                            <!-- Dynamic content will be injected here -->
                        </div>
                        <div class="d-flex justify-content-end mt-4">
                            <button class="btn btn-secondary me-2" onclick="closeModal()">Cancel</button>
                            <button id="confirm-negotiation-btn" class="btn btn-success">Negotiate</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer omitted for brevity -->

    </div>

    <script type="module">
        import { recommendationData } from './assets/js/data.js';

        // Example dataset (can be fetched from API/database)
        const landListings = recommendationData;

        // Helper function to get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                lokasi: params.get('lokasi') || '',
                size: params.get('size') || '',
                type: params.get('type') || '',
                angsur: params.get('angsur') || '',
                negotiable: params.get('negotiable') || ''
            };
        }

        /**
 * Closes the currently open modal by removing the 'open' class and restores body scrolling.
 */
function closeModal() {
    document.querySelector('.custom-modal.open')?.classList.remove('open');
    document.body.classList.remove('modal-open');
}

function toggleFormAddArticle(id) {
    document.getElementById(id)?.classList.add('open');
    document.body.classList.add('modal-open');
}


        // Function to dynamically populate the negotiable modal with item details
        function openNegotiableModal(item) {
            const contentDiv = document.getElementById('negotiable-item-content');
            contentDiv.innerHTML = `
        <p><strong>Location:</strong> ${item.location.address}</p>
        <p><strong>Price:</strong> Rp. ${item.price.toLocaleString()}</p>
        <p><strong>Size:</strong> ${item.size.width} x ${item.size.height} m</p>
        <p><strong>Installment:</strong> ${item.isInstallment ? 'Yes' : 'No'}</p>
        <p><strong>Installment Months:</strong> ${item.monthInstallment}x</p>
        <p><strong>Publisher:</strong> ${item.publisher.name} (${item.publisher.email})</p>
    `;

            console.log(item.isNegotable)

            if (item.isNegotable) {
                contentDiv.innerHTML += `
            <label for="negotiable-price"><strong>Price (Negotiable):</strong></label>
            <input type="text" id="negotiable-price" class="w-full p-2 border rounded" value="${item.price.toLocaleString()}" />
        `;
            } else {
                contentDiv.innerHTML += `
            <p><strong>Price:</strong> Rp. ${item.price.toLocaleString()}</p>
        `;
            }

            // Update the negotiation logic
            document.getElementById('confirm-negotiation-btn').onclick = () => {
                let negotiatedPrice = item.price;

                // If the item is negotiable, capture the user-updated price
                if (item.isNegotable) {
                    const priceInput = document.getElementById('negotiable-price').value;
                    negotiatedPrice = parseFloat(priceInput.replace(/,/g, '')); // Convert formatted price back to number
                }

                console.log('Negotiating with item:', {
                    ...item,
                    negotiatedPrice: negotiatedPrice
                });

                closeModal();
            };

            // Open the modal
            toggleFormAddArticle('negosiasi-modal');
        }


        function applyFilters() {
            const { lokasi, size, type, angsur, negotiable } = getUrlParams();

            // Filter logic
            const filteredListings = landListings.filter(listing => {
                const matchesLokasi = lokasi === '' || listing.location.address.toLowerCase().includes(lokasi.toLowerCase());
                const matchesSize = size === '' || `${listing.size.width}x${listing.size.height}` === size;
                const matchesType = type === '' || listing.type.toLowerCase() === type.toLowerCase();
                const matchesAngsur = angsur === '' || (angsur === 'Yes' && listing.isInstallment) || (angsur === 'No' && !listing.isInstallment);
                const matchesNegotiable = negotiable === '' || (negotiable === 'Yes' && listing.isNegotiable) || (negotiable === 'No' && !listing.isNegotiable);
                return matchesLokasi && matchesSize && matchesType && matchesAngsur && matchesNegotiable;
            });

            console.log(filteredListings, 'filterd 123')

            const tanahRekomendasiDiv = document.getElementById('tanah-rekomendasi');
            tanahRekomendasiDiv.innerHTML = '';

            if (filteredListings.length > 0) {
                filteredListings.forEach((tanah) => {
                    const card = document.createElement('div');
                    card.className = "w-full rounded overflow-hidden shadow-lg";

                    // Image section
                    const imgDiv = document.createElement('div');
                    imgDiv.className = "relative";
                    const img = document.createElement('img');
                    img.className = "w-full";
                    img.src = "https://via.placeholder.com/400";
                    img.alt = "Tanah Image";

                    const priceDiv = document.createElement('div');
                    priceDiv.className = "absolute bottom-4 right-4 bg-white/90 rounded px-4 py-2";
                    priceDiv.innerHTML = `<span class="font-bold text-xl">Rp. ${tanah.price.toLocaleString()}</span>`;
                    imgDiv.appendChild(img);
                    imgDiv.appendChild(priceDiv);
                    card.appendChild(imgDiv);

                    const contentDiv = document.createElement('div');
                    contentDiv.className = "px-6 py-4 space-y-1 text-md";
                    const locationDiv = document.createElement('div');
                    locationDiv.className = "mb-3";
                    locationDiv.innerHTML = `
                        <div class="font-bold text-xl mb-2">${tanah.location.address}</div>
                        <a href="${tanah.location.coordinateGMapsUrl}" class="underline text-sm" target="_blank">Lihat di Google Maps</a>
                    `;
                    contentDiv.appendChild(locationDiv);
                    card.appendChild(contentDiv);

                    // Create button to buy
                    const buttonDiv = document.createElement('div');
                    buttonDiv.className = "p-4";
                    const button = document.createElement('button');
                    button.className = "w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded";
                    button.innerText = "Beli";
                    button.onclick = () => openNegotiableModal(tanah);
                    buttonDiv.appendChild(button);
                    card.appendChild(buttonDiv);




                    tanahRekomendasiDiv.appendChild(card);
                });
            } else {
                tanahRekomendasiDiv.innerHTML = '<p>No listings match your filters.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Event listener for the filter button
            document.querySelector('button[type="button"]').addEventListener('click', applyFilters);
        });

        applyFilters()
    </script>
</body>

</html>